platform: linux

image_resource:
  type: registry-image
  source:
    repository: testinfected/dcind-gradle
    tag: 7-jdk17-alpine

# Cache the Gradle repository directory
caches:
  - path: $HOME/.gradle
inputs:
  - name: sources
  - name: selenium-chrome
  - name: postgres
run:
  path: entrypoint.sh
  args:
    - bash
    - -ceux
    - |
      cd sources
      cp scripts/ci/ci.properties server/src/acceptance/resources/etc
      
      docker compose -f scripts/ci/compose.acceptance.yml up -d
      SERVER_HOST=host.docker.internal gradle acceptanceTest -Penv=ci
